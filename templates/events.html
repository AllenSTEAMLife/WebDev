{% extends "layout.html" %}

{% block title %}Event Calendar{% endblock %}

{% block head %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
<style>
html {
	width:100%;
}
h1 {
	margin-top:12px;
}
body {
  font-family: 'Montserrat', sans-serif;
}
@media (max-width:820px) {
  .card-body p {
  	text-align:center;
  }
  hr {
  	display:block;
  }
}
</style>
{% endblock %}

{% block body %}
{% include "components/nav.html" %}

<section id="page6"></section>
<div class="container mb-5">
  <div style="height:6px;"></div>
  <h1 style="user-select:text;">Events</h1>
  <hr style="height:2px;">
  <div style="height:18px;"></div>
  <p>Stay up to date with what's going on in the STEAM Center!</p>
  
  <hr style="height:2px;background-color:black;width:50%;display:none;">
  <p id="calStatus">Loading calendar...</p>
  <div id="calendarContainer">
    <!-- this will be auto-populated by fullcalendar library -->
  </div>
  <script>
    $(document).ready(function(){
      currentTime = new Date().getTime();

      fetch('/events/json').then(resp => resp.json()).then(data => {
        data = data.Items;
        events = [];
        // Go through each item from the server and create an event
        for(i = 0; i < data.length; i++) {
          item = data[i];
          //get the start and end attributes and convert them into dates
          var sDateSplit = item["Start-Date"]["S"].split("/");
          var sTimeSplit = item["Start-Time"]["S"].split(":");
          var eDateSplit = item["End-Date"]["S"].split("/");
          var eTimeSplit = item["End-Time"]["S"].split(":");
          const startDate = new Date(parseInt(sDateSplit[2]), parseInt(sDateSplit[0]) - 1, parseInt(sDateSplit[1]), parseInt(sTimeSplit[0]), parseInt(sTimeSplit[1]), 0, 0);
          const endDate = new Date(parseInt(eDateSplit[2]), parseInt(eDateSplit[0]) - 1, parseInt(eDateSplit[1]), parseInt(eTimeSplit[0]), parseInt(eTimeSplit[1]), 0, 0);

          e = {
            groupId: "club-" + item["Club"]["N"], // if it is null, it will be a generic group
            title: item["Event-Name"]["S"],
            start: startDate,
            end: endDate,
            url: "/events/" + item["ID"]["S"],
            color: "#AAAAAA"
          };
          events.push(e);
        }

        document.querySelector("#calStatus").innerText = "";

        // Initialize the calendar using the events list
        calElement = document.querySelector("#calendarContainer");
        cal = new FullCalendar.Calendar(calElement, {
          initialView: 'dayGridMonth',
          events: events // use events list
        });
        cal.render();
      }).catch(error => {
        document.querySelector("#calStatus").innerText = "Failed to load calendar, please try again later";
      });
    });
  </script>
</div>

{% include "components/footer.html" %}

{% endblock %}

